<%= render "cohorts/tabs" %>

<div class="row mb-3">
  <div class="col-lg-12 mb-3">
    <div class="d-flex align-items-center">
      <h1 class="me-auto"><%= @cohort.name %></h1>
      <%= link_to "Back to cohorts", cohorts_path, class: "btn btn-outline-secondary me-2" %>
      <% if policy(@cohort).edit? %>
        <%= link_to "Edit this cohort", edit_cohort_path(@cohort), class: "btn btn-outline-secondary me-2" %>
      <% end %>

      <% if policy(@cohort).destroy? %>
        <%= link_to "Delete this cohort", @cohort, data: { "turbo-method": :delete, "turbo-confirm": "Are you sure? This is NOT reversible" }, class: "btn btn-outline-secondary" %>
      <% end %>
    </div>
    <div class="d-flex">
      <%= @cohort.started_on.strftime("%B %Y") %>
    </div>
  </div>
</div>

<% if policy(@cohort).canvas_highest_position_submission_count? %>
  <div class="row mb-3">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-header">
          <h2 class="h6 mb-0">Canvas: Highest Position Submission Count</h2>
        </div>
        <div class="card-body">
          <%= column_chart canvas_highest_position_submission_count_cohort_path(@cohort) %>
        </div>
      </div>
    </div>
  </div>
<% end %>

<% if policy(@cohort).canvas_point_total_most_recent? %>
  <div class="row mb-3">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-header">
          <h2 class="h6 mb-0">Canvas: Total Points (most recent snapshot)</h2>
        </div>
        <div class="card-body">
          <%= column_chart canvas_point_total_most_recent_cohort_path(@cohort) %>
        </div>
      </div>
    </div>
  </div>
<% end %>

<% if @cohort.canvas_shortname.include?("INTRO") %>
  <h2>Inactive Enrollments</h2>
  <div class="row my-2">
    <div class="col-md-6">
      <ul>
        <% @inactive_enrollments.each_with_index do |enrollment, index| %>
          <% if index.even? %>
            <li><%= enrollment.full_name %></li>
          <% end %>
        <% end %>
      </ul>
    </div>
    <div class="col-md-6">
      <ul>
        <% @inactive_enrollments.each_with_index do |enrollment, index| %>
          <% if index.odd? %>
            <li><%= enrollment.full_name %></li>
          <% end %>
        <% end %>
      </ul>
    </div>
  </div>
<% end %>


<!-- Blazer renders this query with jQuery functionality to sort by different columns. Maybe we should just link to that instead? -->
<% if @most_recent_submission_by_student.any? %>
  <div class="row mb-3">
    <div class="col-lg-12">
      <h1 class="h2 mb-0">Most Recent Submission by User</h1>
      <table class="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Highest Assignment Name</th>
            <th>Highest Assignment Position</th>
            <th>Submission Date</th>
            <th>Points</th>
          </tr>
        </thead>
        <tbody>
          <% @most_recent_submission_by_student.each do |submission| %>
            <tr>
              <td><%= submission.name %></td>
              <td><%= submission.highest_assignment_name %></td>
              <td><%= submission.highest_assignment_position %></td>
              <td><%= submission.submission_date %></td>
              <td><%= submission.points %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
<% end %>
