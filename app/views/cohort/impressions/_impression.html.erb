<div id="<%= dom_id(impression) %>" class="card">
  <div class="card-header">
    <div class="d-flex justify-content-between align-items-center">
      <h1 class="me-auto mb-0 h6">
        <%= impression.author %> authored a <%= impression.emoji %> impression of <%= link_to impression.subject, cohort_enrollment_path(@cohort, impression.subject) %>
      </h1>
      <% if policy(impression).edit? %>
        <%= link_to edit_cohort_impression_path(@cohort, impression), class: "me-2" do %>
          <i class="fa-solid fa-pen-to-square"></i>
        <% end %>
      <% end %>
      <% if policy(impression).destroy? %>
        <%= button_to cohort_impression_path(@cohort, impression), data: { "turbo-method": :delete, "turbo-confirm": "Are you sure you want to delete this impression?" }, class: "btn btn-link" do %>
          <i class="fa-solid fa-trash text-danger"></i>
        <% end %>
      <% end %>
    </div>
  </div>

  <div class="card-body">
    <p><%= impression.content %></p>
  </div>

  <div class="card-footer">
    <%= time_ago_in_words(impression.created_at) %> ago
  </div>

  <!-- Comment Section -->
  <div class="card-footer">
    <h6>Comments</h6>

    <ul>
      <% impression.comments.each do |comment| %>
        <li id="<%= dom_id(comment) %>">
          <strong><%= comment.user.name %></strong>: <%= comment.content %>
          <% if policy(comment).destroy? %>
            <%= button_to cohort_impression_comment_path(@cohort, @impression, comment), 
              method: :delete, 
              data: { turbo_confirm: "Are you sure you want to delete this comment?" }, 
              class: "btn btn-link btn-sm float-end p-0" do %>
              <i class="fa-solid fa-trash text-danger"></i>
            <% end %>
          <% end %>
        </li>
      <% end %>
    </ul>

    <%= form_with(model: [@cohort, @impression, Comment.new], url: cohort_impression_comments_path(@cohort, @impression), local: true) do |form| %>
      <div class="form-group">
        <%= form.label :content, "Add a comment:" %>
        <%= form.text_area :content, class: "form-control", rows: 3 %>
      </div>
      <%= form.hidden_field :commentable_type, value: 'Impression' %>
      <%= form.hidden_field :commentable_id, value: @impression.id %>
      <%= form.submit "Submit", class: "btn btn-primary mt-2" %>
    <% end %>

  </div>
</div>
