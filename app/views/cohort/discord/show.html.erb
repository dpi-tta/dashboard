<%= render "cohorts/tabs" %>

<div class="row">
  <div class="col-lg-6">
    <div class="card">
      <div class="card-header d-flex align-items-center">
        <h1 class="h6 mb-0 me-auto"><%= @channel[:name].to_s.capitalize %> Discord Channel for <%= @cohort.name %></h1>
      </div>
      <p class="card-text mb-2">
        <strong>Topic:</strong>
        <%= @channel[:topic].presence || "No topic set" %>
      </p>

      <p class="card-text mb-3">
        <strong>Channel ID:</strong> <%= @channel[:id] %>
      </p>
    </div>
    <div class="card mt-3">
  <div class="card-header">
    <h2 class="h6 mb-0">Schedule Recurring Message</h2>
  </div>
  <div class="card-body">
    <%= form_with url: recurring_messages_cohort_discord_path(@cohort, id: @channel[:id]),
                  method: :post, local: true do |f| %>

      <div class="mb-3">
        <%= f.label :message_content, "Message Content" %>
        <%= f.text_area :message_content, class: "form-control", rows: 2 %>
      </div>

      <div class="mb-3">
        <%= f.label :recurrence_pattern, "Recurrence Pattern" %>
        <%= f.select :recurrence_pattern, [["Daily", "daily"], ["Weekly", "weekly"], ["Custom Cron", "custom"]],
                     {}, class: "form-control" %>
      </div>

      <div class="mb-3">
        <%= f.label :cron_expression, "Custom Cron Expression (if selected)" %>
        <%= f.text_field :cron_expression, class: "form-control" %>
      </div>

      <%= f.submit "Schedule", class: "btn btn-primary" %>
    <% end %>
  </div>
</div>

  </div>
  <div class="col-lg-6">
    <div class="card">
      <div class="card-header d-flex align-items-center">
        <h1 class="h6 mb-0 me-auto">Top Contributors (Last 50 Messages)</h1>
      </div>
      <% if @top_contributors.blank? %>
        <p class="text-muted">No contributors found.</p>
      <% else %>
        <div class="list-group mb-3">
          <% @top_contributors.each do |contributor| %>
            <%= link_to "#", class: "list-group-item list-group-item-action d-flex justify-content-between align-items-center" do %>
              <div class="me-auto">
                <strong>@<%= contributor[:author_username] %></strong>
                <span class="badge bg-primary rounded-pill"><%= contributor[:message_count] %> messages</span>
              </div>
              <div>
                <i class="fa-solid fa-chevron-right fa-fw"></i>
              </div>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
    <div class="card">
      <div class="card-header d-flex align-items-center">
        <h1 class="h6 mb-0 me-auto">Recent Messages</h1>
      </div>
      <% if @recent_messages.blank? %>
        <p class="text-muted">No recent messages found.</p>
      <% else %>
        <div class="list-group mb-3">
          <% @recent_messages.each do |msg| %>
            <%= link_to "#", class: "list-group-item list-group-item-action d-flex justify-content-between align-items-center" do %>
              <div class="me-auto">
                <strong>@<%= msg[:author_username] %></strong>
                <p class="mb-1"><%= msg[:content] %></p>
                <small class="text-muted"><%= msg[:timestamp].strftime("%b %d, %Y %I:%M %p") %></small>
              </div>
              <div>
                <i class="fa-solid fa-chevron-right fa-fw"></i>
              </div>
            <% end %>
          <% end %>
        </div>
      <% end %>

    </div>
  </div>
</div>
